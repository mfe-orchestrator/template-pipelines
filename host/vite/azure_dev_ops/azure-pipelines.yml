trigger:
  branches:
    include:
      - main
      - develop
      - development

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Build
    displayName: 'ğŸ—ï¸ Build Vite.js Application'
    jobs:
      - job: BuildJob
        displayName: 'âš™ï¸ Build and Test'
        steps:
          - task: NodeTool@0
            displayName: 'ğŸ“¦ Install Node.js'
            inputs:
              versionSpec: '24.x'

          - script: npm install -g pnpm
            displayName: 'ğŸ“¦ Install pnpm'

          - task: Cache@2
            displayName: 'ğŸ’¾ Cache node_modules'
            inputs:
              key: 'pnpm | "$(Agent.OS)" | pnpm-lock.yaml'
              path: node_modules
              restoreKeys: |
                pnpm | "$(Agent.OS)"

          - script: pnpm i
            displayName: 'ğŸ“¥ Install dependencies'

          - script: pnpm build
            displayName: 'ğŸ”¨ Build Vite project'

          - task: PublishBuildArtifacts@1
            displayName: 'ğŸ“¤ Publish build artifacts'
            inputs:
              PathtoPublish: 'dist'
              ArtifactName: 'vite-app'
              publishLocation: 'Container'

          - task: mfe-orchestrator-upload@1.0.8
            displayName: 'Upload Microfrontend'
            inputs:
              apiKey: '03e8de76-d38f-4396-8def-1f3f712d3a3f'
              microfrontendSlug: 'design-system'
              filePath: 'dist'
              version: '$(Build.BuildNumber)'